@model Itadakimasu.Models.ViewFoodViewer

@{
    ViewData["Title"] = "Home Page";
}

<div class="row">
    <div class="col-2">
        <ul class="list-group">
            @foreach (var item in Model.Foods)
            {
                <li class="list-group-item d-flex justify-content-between">
                    <a href="@item.Name">@(item.Name)</a><span class="badge bg-light text-dark rounded-pill">@item.FoodImageCount</span>
                </li>
            }
        </ul>
    </div>
    <div class="col-10">
        <div class="d-flex flex-row">
            @await Html.PartialAsync("_Select", ViewData["SelectViewerCount"])
            @await Html.PartialAsync("_Select", ViewData["SelectViewerSize"])
        </div>
        <div class="d-flex flex-row">
            <div class="col-auto px-2 py-1">
              <input class="form-check-input" type="checkbox" id="check-all" onclick="allChecked(this)">
              <label class="form-check-label" for="check-all">全チェック</label>
            </div>
            <div class="col-auto">
                <button type="button" class="btn btn-outline-primary btn-sm">1</button>
                <button type="button" class="btn btn-outline-primary btn-sm">2</button>
                <button type="button" class="btn btn-outline-primary btn-sm">3</button>
            </div>
        </div>
        <div>
            <ul class="d-flex flex-wrap">
                @for (var i = 0; i < Model.FoodImages.Count; i++)
                {
                    var item = Model.FoodImages[i];
                    <li class="list-group-item">
                        <div class="d-flex flex-row justify-content-between">
                            <div>
                                <input class="check_@(item.Id)" name="checkbox" type="checkbox" onclick="checkSync(this)" />
                            </div>
                            <div></div>
                            <div>
                                @{
                                    if(item.StatusNumber != 0){ <div class="badge rounded-pill bg-dark">@item.StatusNumber</div> }
                                }
                            </div>
                        </div>
                        <div>
                            <label for="popup_@(item.Id)">
                                <span class="btn">
                                    <img class="img-thumbnail @(ViewData["CurrentViewerSize"])" src="@item.BlobSUrl" alt='@(item.Name)の画像' title="@(item.Name)">
                                </span>
                            </label>
                        </div>
                        <div class="d-flex flex-row justify-content-center">
                            <span>@(item.Name)</span>
                        </div>
                         <div class="popup_wrap">
                            <input id="popup_@(item.Id)" type="checkbox">
                            <div class="popup_overlay">
                                <label for="popup_@(item.Id)" class="popup_trigger"></label>
                                <div class="popup_content">
                                    <div class="d-flex flex-row justify-content-between">
                                        <div>
                                            <input class="check_@(item.Id)" name="checkbox" type="checkbox" onclick="checkSync(this)" />
                                        </div>
                                        <div></div>
                                        <div>
                                            @{
                                                if (item.StatusNumber != 0)
                                                {
                                                    <div class="badge rounded-pill bg-dark">@item.StatusNumber</div>
                                                } 
                                            }
                                        </div>
                                        <div>
                                            <label for="popup_@(item.Id)" class="close_btn"><i class="fa-regular fa-circle-xmark"></i></label>
                                        </div>
                                    </div>
                                    <a class="btn btn-link" onclick="changeImage('popup_@(item.Id)', 'popup_@(item.NextId)')">
                                        <img class="popup_content_img" src="@item.BlobUrl">
                                    </a>
                                    <div class="d-flex flex-row justify-content-center">
                                        <div>@item.Name</div>
                                    </div>
                                    <div class="d-flex flex-row justify-content-center">
                                        <div></div>
                                        <a href="#" class="badge rounded-pill bg-light text-dark btn-foodImage" data-value="1" data-id="@(item.Id)">1</a>
                                        <a href="#" class="badge rounded-pill bg-light text-dark btn-foodImage" data-value="2" data-id="@(item.Id)">2</a>
                                        <a href="#" class="badge rounded-pill bg-light text-dark btn-foodImage" data-value="3" data-id="@(item.Id)">3</a>
                                        <a href="#" class="badge rounded-pill bg-light text-dark btn-foodImage" data-value="4" data-id="@(item.Id)">4</a>
                                    </div>
                                    <div class="d-flex flex-row justify-content-between">
                                        <button type="button" class="btn btn-link" onclick="changeImage('popup_@(item.Id)', 'popup_@(item.PrevId)')">&laquo;&laquo;前へ</button>
                                        <a>@(i + 1)/@(Model.FoodImages.Count)</a>
                                        <button type="button" class="btn btn-link" onclick="changeImage('popup_@(item.Id)', 'popup_@(item.NextId)')">次へ&raquo;&raquo;</button>
                                    </div>
                                </div>
                            </div>
                         </div>
                     </li>
                }
            </ul>
            <div class="clearfix" />
        </div>
        @await Html.PartialAsync("_Pagination", Model.FoodImages.Parameter)
    </div>
</div>

<script type="text/javascript">
    document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('.btn-foodImage').forEach(btn => btn.addEventListener('click', async (event) => {
            const response = await fetch('/api/FoodImages/food-image-state', {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ Id: event.target.dataset.id, StateNumber: event.target.dataset.value })
            });
            if (!response.ok) return;


        }));
    });
</script>

